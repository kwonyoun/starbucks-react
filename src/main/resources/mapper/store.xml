<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.starbucks_react.mapper.StoreMapper">

    <select id="getAllStores" resultType="com.example.starbucks_react.dto.StoreDto">
        SELECT
            id,
            store_name AS storeName,
            x,
            y,
            store_type AS storeType,
            store_addr AS storeAddr,
            (
                6371 * acos(
                    cos(radians(#{lat})) * cos(radians(y))
                    * cos(radians(x) - radians(#{lng}))
                    + sin(radians(#{lat})) * sin(radians(y))
                )
            ) AS distance
        FROM starbugs_store
        ORDER BY distance
        LIMIT 20
    </select>

</mapper>